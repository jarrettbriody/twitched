<!DOCTYPE html>
<html>
  <head>
    <title>Twitched</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      
    </style>
  </head>
  <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
      window.onload = function() {
        if(chrome.runtime.lastError) chrome.runtime.lastError = null;

        var baseUrl = "https://twitchedapp.herokuapp.com/";
        
        $("#userNameForm").submit(function(e){
          var action = $("#userNameForm").attr("action");
          var name = "name=" + encodeURIComponent($("#userName").val());
          name = name.toLowerCase();
          //console.log("HELLOOOOO: " + baseUrl + action + name);
          $.ajax({
            cache: false,
            type: "get",
            url: baseUrl + action,
            data: name,
            dataType: "json",
            success: function (result, status, xhr) {
              var resultText = JSON.stringify(result);
              $("#result").text(resultText);
              var json = JSON.parse(result);
              
              var newImg = document.createElement("img");
              newImg.src = json.users[0].logo;
              document.querySelector("#result").appendChild(newImg);

            },
            error: function (result, status, xhr) {
              var resultText = JSON.stringify(result);
              $("#result").text(resultText);
              console.dir(result);
              //$("#result").text(result.responseJSON.error);
            }
          });
          e.preventDefault();
          return false;
        });
      };
    </script>
    <form id="userNameForm" action="/user" method="get">
      <input id="userName" type="text" name="name" placeholder="Twitch Username" value = "loltyler1">
      <input type="submit" value="Generate">
    </form>
    <div id="result">
    
    </div>
  </body>
</html>